#!/usr/bin/env node

var optimist = require('optimist');
    Log4Node = require('log4node'),
    agent = require('../lib/agent.js');

var argv = optimist.argv;

function help() {
  console.log("Syntax : node-logstasth-agent [--log_level=info] [--config_file=toto.json|--config_dir=/etc/config] urls");
  console.log("Url examples");
  console.log("input://stdin://");
  console.log("input://file://main_input.txt?type=toto");
  console.log("output://stdout://");
  console.log("output://file:///tmp/toto.txt");
}

var logger = new Log4Node(argv.log_level || 'warning');

var logstashAgent = agent.create();

logstashAgent.set_logger(logger);

logstashAgent.on('error', function(module_name, error) {
  logger.error("Error on module " + module_name + " : " + error);
});

logstashAgent.load_urls(argv._, function(err) {
  if (err) {
    logger.error("Unable to load urls : " + err);
    process.exit(2);
  }
});
